#+TITLE: Blog Gridsome With Org


Go back to inbox: [[file:2020-03-02.org][Other Brain Inbox]]
* [[file:c:/Users/wjb/.doom.d/autoload/utils.el][Global utils helpers]]

#+BEGIN_SRC emacs-lisp
;;;###autoload
(defun org-global-props (&optional property buffer)
  "Get the plists of global org properties of current buffer."
  (unless property (setq property "PROPERTY"))
  (with-current-buffer (or buffer (current-buffer))
    (org-element-map (org-element-parse-buffer) 'keyword (lambda (el) (when (string-match property (org-element-property :key el)) el)))))

;;;###autoload
(defun org-global-prop-value (key)
  "Get global org property KEY of current buffer."
  (org-element-property :value (car (org-global-props key))))

(org-global-prop-value "title")
#+END_SRC

#+RESULTS:
: Blog Gridsome With Org

* Module setting

[[file:c:/Users/wjb/.doom.d/extensions/app+blog.el][gridsome module config]]


#+BEGIN_SRC emacs-lisp
;;;###autoload
(defun my-org-export-md-to-gridsome-newpost ()
	"Saving the current org file as a gridsome post
in a specific hugo post directory, will insert
front matter with the file title and date"
	(interactive)
	(progn
    (setq gridsome-post-subdir (ido-completing-read "Directory Name: " '("blog" "docs")))
  	(setq gridsome-post-base-name
          (or
           (org-global-prop-value "title")
           (read-from-minibuffer "File Name (Slug Format): " "name-your-blog")))
  	(setq gridsome-post-filepath
          (my-find-gridsome-filepath gridsome-post-subdir gridsome-post-base-name))
    (message gridsome-post-filepath)
    (org-md-export-as-markdown)
    (goto-char (point-min))
    (insert "---\n")
    (insert (concat "title: "
                    (replace-regexp-in-string "-" " " gridsome-post-base-name)))
    (insert "\nauthor: Xing Wenju\n")
    (insert (concat "date: "
                    (format-time-string "%Y-%m-%d")))
    (insert "\nexcerpt: \n---\n")
    (evil-save gridsome-post-filepath)
    (evil-window-delete)
    (find-file gridsome-post-filepath)))
#+END_SRC

#+RESULTS:
: my-org-export-md-to-gridsome-newpost
